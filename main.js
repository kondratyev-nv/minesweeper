!function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var e={};n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=3)}([function(t,n,e){"use strict";t.exports=function(t,n,e){var i=!1,o=!1;return{x:t,y:n,value:e,open:function(){return i=!1,o=!0,this.value},isOpened:function(){return o},mark:function(){i=!0},unmark:function(){i=!1},isMarked:function(){return i}}}},function(t,n,e){"use strict";t.exports=function(){var t=[];return{add:function(n,e){if("function"!=typeof n)throw new Error("could not add non-function listener");t.push({fn:n,scope:e})},remove:function(n){for(var e=0;e<t.length;e++)if(t[e].fn===n){t.splice(e,1);break}},notify:function(){for(var n=0;n<t.length;n++){var e=t[n];e.fn.apply(e.scope,arguments)}}}}},function(t,n,e){"use strict";t.exports={getRandomInteger:function(t,n){return Math.floor(Math.random()*(n-t))+t}}},function(t,n,e){"use strict";e(4);var i=e(5),o=e(6),r=e(7),s=e(9),h=e(2);!function(t,n,e){var a=document.getElementById("minesweeper-canvas"),f=i(10,10,10,h.getRandomInteger),c=new o(f),u=new r(a,10,10);u.openTile.add(c.open,c),u.markTile.add(c.toggleMark,c);new s(a,document.getElementById("minesweeper-status"),c)}()},function(t,n){},function(t,n,e){"use strict";var i=e(0);t.exports=function(t,n,e,o){for(var r=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],s=function(e,i){return 0<=e&&e<t&&0<=i&&i<n},h=function(t,n){s(t,n)&&a[n][t].value>=0&&(a[n][t].value+=1)},a=[],f=0;f<n;++f){a[f]=[];for(var c=0;c<t;++c)a[f][c]=i(c,f,0)}for(var u=0;u<e;){var l=o(0,t),p=o(0,n);a[p][l].value>=0&&(!function(t,n){a[n][t].value=-1,r.forEach(function(e){return h(t+e[0],n+e[1])})}(l,p),u+=1)}return{at:function(t,n){return a[n][t]},getNeightboursOf:function(t,n){return r.filter(function(e){return s(t+e[0],n+e[1])}).map(function(e){return a[n+e[1]][t+e[0]]})},width:function(){return t},height:function(){return n},numberOfMines:function(){return e}}}},function(t,n,e){"use strict";function i(t){this.field=t,this.marksLeft=t.numberOfMines(),this.onMineFound=o(),this.onTileOpened=o(),this.onMarkTile=o(),this.onUnmarkTile=o(),this.onWin=o()}var o=(e(0),e(1));e(2);i.prototype.width=function(){return this.field.width()},i.prototype.height=function(){return this.field.height()},i.prototype.getTotalMinesCount=function(){return this.field.numberOfMines()},i.prototype.getMarkInfo=function(){return{left:this.marksLeft,total:this.getTotalMinesCount()}},i.prototype.canOpen=function(t,n){return 0<=t&&t<this.width()&&0<=n&&n<this.height()},i.prototype.open=function(t,n){var e=this;if(this.canOpen(t,n)){if(this.field.at(t,n).isOpened())return;var i=this.field.at(t,n).open();if(i<0){this.onMineFound.notify(t,n);for(var o=0;o<this.height();++o)for(var r=0;r<this.width();++r)this.open(r,o)}else this.onTileOpened.notify(t,n,i),0===i&&this.field.getNeightboursOf(t,n).filter(function(t){return!t.isMarked()}).forEach(function(t){return e.open(t.x,t.y)});this.checkComplete()}},i.prototype.toggleMark=function(t,n){this.canOpen(t,n)&&(this.field.at(t,n).isOpened()||(this.field.at(t,n).isMarked()?(this.field.at(t,n).unmark(),this.marksLeft+=1,this.onUnmarkTile.notify(t,n)):this.marksLeft>0&&(this.field.at(t,n).mark(),this.marksLeft-=1,this.onMarkTile.notify(t,n),this.checkComplete())))},i.prototype.checkComplete=function(){if(0===this.marksLeft){for(var t=0,n=0;n<this.width();++n)for(var e=0;e<this.height();++e){if(this.field.at(n,e).isMarked()&&this.field.at(n,e).value>=0)return;this.field.at(n,e).isOpened()&&t++}t===this.width()*this.height()-this.getTotalMinesCount()&&this.onWin.notify()}},t.exports=i},function(t,n,e){"use strict";function i(t,n,e){this.canvas=t,this.nx=n,this.ny=e,this.cw=this.canvas.clientWidth,this.ch=this.canvas.clientHeight,this.canvas.addEventListener("click",this.onLeftButtonClick.bind(this),!1),this.canvas.addEventListener("contextmenu",function(t){t.preventDefault(),this.onRightButtonClick(t)}.bind(this),!1)}var o=e(8);i.prototype=new o,i.prototype.constructor=i,i.prototype.getTile=function(t,n){return{x:this.nx*t/this.cw|0,y:this.ny*n/this.ch|0}},i.prototype.onLeftButtonClick=function(t){var n=t.offsetX,e=t.offsetY,i=this.getTile(n,e);this.openTile.notify(i.x,i.y)},i.prototype.onRightButtonClick=function(t){var n=t.offsetX,e=t.offsetY,i=this.getTile(n,e);this.markTile.notify(i.x,i.y)},t.exports=i},function(t,n,e){"use strict";function i(){this.openTile=o(),this.markTile=o()}var o=e(1);i.prototype={constructor:i,openTile:null,markTile:null},t.exports=i},function(t,n,e){"use strict";function i(t,n,e){var i=this;this.canvas=t,this.statusText=n,this.ctx=t.getContext("2d"),this.minesweeper=e,this.w=e.width(),this.h=e.height(),this.n=e.getTotalMinesCount(),e.onMineFound.add(function(t,n){return i.onMineFound(t,n)}),e.onTileOpened.add(function(t,n,e){return i.fillTile(t,n,e,"#b5e853")}),e.onMarkTile.add(function(t,n){return i.fillTile(t,n,"M","#ff0000")}),e.onUnmarkTile.add(function(t,n){return i.clearTile(t,n)}),e.onWin.add(function(){return i.showMessage("You won!")}),this.drawMesh(this.ctx,this.canvas.width,this.canvas.height,this.canvas.width/this.w,this.canvas.height/this.h)}i.prototype.showMessage=function(t){this.statusText.innerHTML=t},i.prototype.showMarkInfo=function(){var t=this.minesweeper.getMarkInfo();this.showMessage("Marks left: "+t.left+" of "+t.total)},i.prototype.drawMesh=function(t,n,e,i,o){this.ctx.strokeStyle="#b5e853";for(var r=0;r<=n;r+=i)this.ctx.moveTo(r,0),this.ctx.lineTo(r,e);for(var s=0;s<=e;s+=o)this.ctx.moveTo(0,s),this.ctx.lineTo(n,s);this.ctx.stroke(),this.showMarkInfo()},i.prototype.getPosition=function(t,n){var e=this.canvas.width/this.w,i=this.canvas.height/this.h;return{x:t*e,y:n*i,w:e,h:i}},i.prototype.onMineFound=function(t,n){var e=this.getPosition(t,n);this.ctx.fillStyle="#ff0000",this.ctx.clearRect(e.x,e.y,e.w,e.h),this.ctx.fillRect(e.x,e.y,e.w,e.h),this.ctx.stroke(),this.showMessage("You lost!")},i.prototype.fillTile=function(t,n,e,i){var o=this.getPosition(t,n);this.ctx.fillStyle=i,this.ctx.font='bold 30px Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.clearRect(o.x,o.y,o.w,o.h),this.ctx.fillText(e,o.x+o.w/2,o.y+o.h/2),this.ctx.stroke(),this.showMarkInfo()},i.prototype.clearTile=function(t,n){var e=this.getPosition(t,n);this.ctx.clearRect(e.x,e.y,e.w,e.h),this.ctx.stroke(),this.showMarkInfo()},t.exports=i}]);